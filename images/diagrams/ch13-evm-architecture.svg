<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 500" width="800" height="500">
  <defs>
    <!-- Background gradient -->
    <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FAFBFC"/>
      <stop offset="100%" style="stop-color:#F0F4F8"/>
    </linearGradient>

    <!-- Drop shadow -->
    <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="3" stdDeviation="5" flood-opacity="0.1"/>
    </filter>

    <!-- Component gradients -->
    <linearGradient id="stackGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3B82F6"/>
      <stop offset="100%" style="stop-color:#2563EB"/>
    </linearGradient>
    <linearGradient id="memoryGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F59E0B"/>
      <stop offset="100%" style="stop-color:#D97706"/>
    </linearGradient>
    <linearGradient id="storageGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981"/>
      <stop offset="100%" style="stop-color:#059669"/>
    </linearGradient>
    <linearGradient id="calldataGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8B5CF6"/>
      <stop offset="100%" style="stop-color:#7C3AED"/>
    </linearGradient>

    <!-- Arrow -->
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#9CA3AF"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="100%" height="100%" fill="url(#bgGradient)"/>

  <!-- Subtle grid -->
  <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
    <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#E5E7EB" stroke-width="0.5"/>
  </pattern>
  <rect width="100%" height="100%" fill="url(#grid)" opacity="0.4"/>

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#1a1a3a">
    EVM Architecture
  </text>
  <text x="400" y="48" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#6B7280">
    Stack machine with four data regions
  </text>

  <!-- Stack (1) -->
  <g transform="translate(100, 85)" filter="url(#dropShadow)">
    <!-- Header -->
    <rect x="-70" y="0" width="140" height="35" rx="8" fill="url(#stackGradient)"/>
    <circle cx="-50" cy="17" r="10" fill="#FFF" fill-opacity="0.2"/>
    <text x="-50" y="21" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#FFF">1</text>
    <text x="10" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#FFF">Stack</text>

    <!-- Content -->
    <rect x="-70" y="40" width="140" height="170" rx="8" fill="#FFF" stroke="#3B82F6" stroke-width="2"/>

    <!-- Stack items -->
    <rect x="-55" y="55" width="110" height="22" rx="4" fill="#DBEAFE" stroke="#3B82F6" stroke-width="1"/>
    <text x="0" y="70" text-anchor="middle" font-family="monospace" font-size="9" fill="#1E40AF">Top (item 0)</text>

    <rect x="-55" y="82" width="110" height="22" rx="4" fill="#EFF6FF" stroke="#BFDBFE" stroke-width="1"/>
    <text x="0" y="97" text-anchor="middle" font-family="monospace" font-size="9" fill="#3B82F6">item 1</text>

    <rect x="-55" y="109" width="110" height="22" rx="4" fill="#EFF6FF" stroke="#BFDBFE" stroke-width="1"/>
    <text x="0" y="124" text-anchor="middle" font-family="monospace" font-size="9" fill="#3B82F6">item 2</text>

    <text x="0" y="148" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#9CA3AF">⋮</text>

    <rect x="-55" y="158" width="110" height="22" rx="4" fill="#DBEAFE" stroke="#3B82F6" stroke-width="1"/>
    <text x="0" y="173" text-anchor="middle" font-family="monospace" font-size="9" fill="#1E40AF">item 1023</text>

    <!-- Specs -->
    <text x="0" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#6B7280">1024 max • 256-bit • LIFO</text>
  </g>

  <!-- Memory (2) -->
  <g transform="translate(280, 85)" filter="url(#dropShadow)">
    <!-- Header -->
    <rect x="-75" y="0" width="150" height="35" rx="8" fill="url(#memoryGradient)"/>
    <circle cx="-55" cy="17" r="10" fill="#FFF" fill-opacity="0.2"/>
    <text x="-55" y="21" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#FFF">2</text>
    <text x="10" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#FFF">Memory</text>

    <!-- Content -->
    <rect x="-75" y="40" width="150" height="170" rx="8" fill="#FFF" stroke="#F59E0B" stroke-width="2"/>

    <!-- Memory layout -->
    <g transform="translate(0, 58)">
      <text x="-60" y="0" font-family="monospace" font-size="8" fill="#9CA3AF">0x00</text>
      <rect x="-30" y="-10" width="95" height="20" rx="3" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1"/>
      <text x="17" y="3" text-anchor="middle" font-family="monospace" font-size="8" fill="#92400E">Free ptr</text>
    </g>

    <g transform="translate(0, 85)">
      <text x="-60" y="0" font-family="monospace" font-size="8" fill="#9CA3AF">0x40</text>
      <rect x="-30" y="-10" width="95" height="20" rx="3" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1"/>
      <text x="17" y="3" text-anchor="middle" font-family="monospace" font-size="8" fill="#92400E">Scratch</text>
    </g>

    <g transform="translate(0, 112)">
      <text x="-60" y="0" font-family="monospace" font-size="8" fill="#9CA3AF">0x60</text>
      <rect x="-30" y="-10" width="95" height="20" rx="3" fill="#FFFBEB" stroke="#FCD34D" stroke-width="1"/>
      <text x="17" y="3" text-anchor="middle" font-family="monospace" font-size="8" fill="#B45309">Zero slot</text>
    </g>

    <g transform="translate(0, 150)">
      <text x="-60" y="0" font-family="monospace" font-size="8" fill="#9CA3AF">0x80+</text>
      <rect x="-30" y="-10" width="95" height="35" rx="3" fill="#FFFBEB" stroke="#FCD34D" stroke-width="1" stroke-dasharray="4,2"/>
      <text x="17" y="10" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#B45309">Expandable</text>
    </g>

    <!-- Specs -->
    <text x="0" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#6B7280">Byte array • Volatile • O(n²)</text>
  </g>

  <!-- Storage (3) -->
  <g transform="translate(475, 85)" filter="url(#dropShadow)">
    <!-- Header -->
    <rect x="-85" y="0" width="170" height="35" rx="8" fill="url(#storageGradient)"/>
    <circle cx="-65" cy="17" r="10" fill="#FFF" fill-opacity="0.2"/>
    <text x="-65" y="21" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#FFF">3</text>
    <text x="10" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#FFF">Storage</text>

    <!-- Content -->
    <rect x="-85" y="40" width="170" height="170" rx="8" fill="#FFF" stroke="#10B981" stroke-width="2"/>

    <!-- Storage slots -->
    <g transform="translate(0, 58)">
      <text x="-70" y="0" font-family="monospace" font-size="8" fill="#9CA3AF">slot 0</text>
      <rect x="-30" y="-10" width="110" height="20" rx="3" fill="#D1FAE5" stroke="#10B981" stroke-width="1"/>
      <text x="25" y="3" text-anchor="middle" font-family="monospace" font-size="8" fill="#065F46">owner</text>
    </g>

    <g transform="translate(0, 85)">
      <text x="-70" y="0" font-family="monospace" font-size="8" fill="#9CA3AF">slot 1</text>
      <rect x="-30" y="-10" width="110" height="20" rx="3" fill="#D1FAE5" stroke="#10B981" stroke-width="1"/>
      <text x="25" y="3" text-anchor="middle" font-family="monospace" font-size="8" fill="#065F46">totalSupply</text>
    </g>

    <g transform="translate(0, 112)">
      <text x="-70" y="0" font-family="monospace" font-size="8" fill="#9CA3AF">slot 2</text>
      <rect x="-30" y="-10" width="110" height="20" rx="3" fill="#ECFDF5" stroke="#6EE7B7" stroke-width="1"/>
      <text x="25" y="3" text-anchor="middle" font-family="monospace" font-size="8" fill="#047857">balances[...]</text>
    </g>

    <g transform="translate(0, 150)">
      <text x="-70" y="0" font-family="monospace" font-size="8" fill="#9CA3AF">...</text>
      <rect x="-30" y="-10" width="110" height="35" rx="3" fill="#ECFDF5" stroke="#6EE7B7" stroke-width="1" stroke-dasharray="4,2"/>
      <text x="25" y="10" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#047857">2²⁵⁶ slots</text>
    </g>

    <!-- Specs -->
    <text x="0" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#6B7280">Persistent • 256→256 • 20k gas</text>
  </g>

  <!-- Calldata (4) -->
  <g transform="translate(640, 85)" filter="url(#dropShadow)">
    <!-- Header -->
    <rect x="-60" y="0" width="120" height="35" rx="8" fill="url(#calldataGradient)"/>
    <circle cx="-40" cy="17" r="10" fill="#FFF" fill-opacity="0.2"/>
    <text x="-40" y="21" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#FFF">4</text>
    <text x="15" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#FFF">Calldata</text>

    <!-- Content -->
    <rect x="-60" y="40" width="120" height="170" rx="8" fill="#FFF" stroke="#8B5CF6" stroke-width="2"/>

    <!-- Calldata structure -->
    <g transform="translate(0, 65)">
      <rect x="-45" y="-15" width="90" height="25" rx="3" fill="#EDE9FE" stroke="#8B5CF6" stroke-width="1"/>
      <text x="0" y="-2" text-anchor="middle" font-family="monospace" font-size="9" font-weight="bold" fill="#5B21B6">selector</text>
      <text x="0" y="8" text-anchor="middle" font-family="monospace" font-size="7" fill="#7C3AED">4 bytes</text>
    </g>

    <g transform="translate(0, 100)">
      <rect x="-45" y="-15" width="90" height="22" rx="3" fill="#F5F3FF" stroke="#C4B5FD" stroke-width="1"/>
      <text x="0" y="0" text-anchor="middle" font-family="monospace" font-size="8" fill="#6D28D9">arg[0]</text>
    </g>

    <g transform="translate(0, 130)">
      <rect x="-45" y="-15" width="90" height="22" rx="3" fill="#F5F3FF" stroke="#C4B5FD" stroke-width="1"/>
      <text x="0" y="0" text-anchor="middle" font-family="monospace" font-size="8" fill="#6D28D9">arg[1]</text>
    </g>

    <g transform="translate(0, 165)">
      <rect x="-45" y="-15" width="90" height="22" rx="3" fill="#FAF5FF" stroke="#DDD6FE" stroke-width="1" stroke-dasharray="4,2"/>
      <text x="0" y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#7C3AED">...</text>
    </g>

    <!-- Specs -->
    <text x="0" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" fill="#6B7280">Read-only • ABI • 3 gas/byte</text>
  </g>

  <!-- Bytecode/PC section -->
  <g transform="translate(400, 330)" filter="url(#dropShadow)">
    <rect x="-360" y="0" width="720" height="70" rx="10" fill="#FFF" stroke="#64748B" stroke-width="2"/>

    <!-- Header -->
    <rect x="-360" y="0" width="720" height="25" rx="10" fill="#475569"/>
    <rect x="-360" y="12" width="720" height="13" fill="#475569"/>
    <text x="0" y="17" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#FFF">Program Counter &amp; Bytecode</text>

    <!-- Bytecode -->
    <text x="-340" y="45" font-family="monospace" font-size="9" fill="#334155">60 80 60 40 52 34 80 15 61 00 10 57 60 00 80 fd 5b 50 61 03 e8 80 61 00 1f 60 00 39 60 00 f3 ...</text>
    <text x="-340" y="60" font-family="monospace" font-size="7" fill="#94A3B8">PUSH1 PUSH1 MSTORE CALLVALUE DUP1 ISZERO PUSH2 JUMPI PUSH1 DUP1 REVERT JUMPDEST POP PUSH2 ...</text>

    <!-- PC indicator -->
    <polygon points="-300,30 -295,22 -290,30" fill="#EF4444"/>
    <text x="-295" y="19" text-anchor="middle" font-family="Arial, sans-serif" font-size="7" font-weight="bold" fill="#EF4444">PC</text>

    <!-- Gas meter -->
    <g transform="translate(300, 45)">
      <text x="0" y="-10" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#374151">Gas Remaining</text>
      <rect x="-45" y="-5" width="90" height="14" rx="7" fill="#FEE2E2" stroke="#EF4444" stroke-width="1"/>
      <rect x="-45" y="-5" width="60" height="14" rx="7" fill="#EF4444"/>
      <text x="0" y="6" text-anchor="middle" font-family="monospace" font-size="8" fill="#FFF">67%</text>
    </g>
  </g>

  <!-- Data flow arrows -->
  <path d="M 170 300 Q 220 320 270 300" stroke="#9CA3AF" stroke-width="1.5" fill="none" marker-end="url(#arrow)" stroke-dasharray="4,2"/>
  <path d="M 360 300 Q 420 320 475 300" stroke="#9CA3AF" stroke-width="1.5" fill="none" marker-end="url(#arrow)" stroke-dasharray="4,2"/>
  <path d="M 555 300 Q 595 320 625 300" stroke="#9CA3AF" stroke-width="1.5" fill="none" marker-end="url(#arrow)" stroke-dasharray="4,2"/>

  <!-- Key insight -->
  <g transform="translate(400, 455)">
    <rect x="-280" y="-18" width="560" height="40" rx="8" fill="#EFF6FF" stroke="#3B82F6" stroke-width="1"/>
    <text y="-2" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#1E40AF">Key Insight</text>
    <text y="14" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#1D4ED8">Storage is expensive (20,000 gas to write), Memory is cheap (3 gas + expansion), Stack is free. Design accordingly.</text>
  </g>
</svg>
