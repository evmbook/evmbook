<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 500" width="800" height="500">
  <!-- Background -->
  <rect width="100%" height="100%" fill="#FAFAFA"/>

  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#333">
    EVM Architecture
  </text>

  <!-- Stack (Left) -->
  <g transform="translate(120, 100)">
    <text y="-15" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">Stack</text>
    <text y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">(1024 items max)</text>

    <!-- Stack visualization -->
    <rect x="-60" y="20" width="120" height="30" fill="#E3F2FD" stroke="#2196F3" stroke-width="2"/>
    <text x="0" y="40" text-anchor="middle" font-family="monospace" font-size="10" fill="#333">Top (item 0)</text>

    <rect x="-60" y="50" width="120" height="30" fill="#E3F2FD" stroke="#2196F3" stroke-width="1"/>
    <text x="0" y="70" text-anchor="middle" font-family="monospace" font-size="10" fill="#333">item 1</text>

    <rect x="-60" y="80" width="120" height="30" fill="#E3F2FD" stroke="#2196F3" stroke-width="1"/>
    <text x="0" y="100" text-anchor="middle" font-family="monospace" font-size="10" fill="#333">item 2</text>

    <rect x="-60" y="110" width="120" height="30" fill="#BBDEFB" stroke="#2196F3" stroke-width="1"/>
    <text x="0" y="130" text-anchor="middle" font-family="monospace" font-size="10" fill="#666">...</text>

    <rect x="-60" y="140" width="120" height="30" fill="#90CAF9" stroke="#2196F3" stroke-width="1"/>
    <text x="0" y="160" text-anchor="middle" font-family="monospace" font-size="10" fill="#333">item 1023</text>

    <!-- Stack note -->
    <text y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">LIFO: Push/Pop</text>
    <text y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">256-bit words</text>
  </g>

  <!-- Memory (Center) -->
  <g transform="translate(320, 100)">
    <text y="-15" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">Memory</text>
    <text y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">(Volatile, per call)</text>

    <!-- Memory visualization -->
    <rect x="-80" y="20" width="160" height="150" fill="#FFF3E0" stroke="#FF9800" stroke-width="2"/>

    <!-- Memory addresses -->
    <text x="-70" y="45" font-family="monospace" font-size="9" fill="#666">0x00</text>
    <rect x="-40" y="32" width="100" height="18" fill="#FFE0B2" stroke="#FF9800" stroke-width="1"/>
    <text x="10" y="45" text-anchor="middle" font-family="monospace" font-size="8" fill="#333">Free mem ptr</text>

    <text x="-70" y="70" font-family="monospace" font-size="9" fill="#666">0x20</text>
    <rect x="-40" y="57" width="100" height="18" fill="#FFE0B2" stroke="#FF9800" stroke-width="1"/>
    <text x="10" y="70" text-anchor="middle" font-family="monospace" font-size="8" fill="#333">Scratch space</text>

    <text x="-70" y="95" font-family="monospace" font-size="9" fill="#666">0x40</text>
    <rect x="-40" y="82" width="100" height="18" fill="#FFECB3" stroke="#FF9800" stroke-width="1"/>
    <text x="10" y="95" text-anchor="middle" font-family="monospace" font-size="8" fill="#333">Allocated</text>

    <text x="-70" y="130" font-family="monospace" font-size="9" fill="#666">...</text>
    <rect x="-40" y="117" width="100" height="40" fill="#FFF8E1" stroke="#FF9800" stroke-width="1" stroke-dasharray="3,2"/>
    <text x="10" y="140" text-anchor="middle" font-family="monospace" font-size="8" fill="#999">Expandable</text>

    <!-- Memory note -->
    <text y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Linear byte array</text>
    <text y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Gas cost grows</text>
  </g>

  <!-- Storage (Right) -->
  <g transform="translate(540, 100)">
    <text y="-15" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">Storage</text>
    <text y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">(Persistent, on-chain)</text>

    <!-- Storage visualization -->
    <rect x="-90" y="20" width="180" height="150" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2"/>

    <!-- Storage slots -->
    <g transform="translate(0, 40)">
      <text x="-80" y="0" font-family="monospace" font-size="9" fill="#666">slot 0</text>
      <rect x="-40" y="-12" width="120" height="18" fill="#C8E6C9" stroke="#4CAF50" stroke-width="1"/>
      <text x="20" y="0" text-anchor="middle" font-family="monospace" font-size="8" fill="#333">owner address</text>
    </g>

    <g transform="translate(0, 65)">
      <text x="-80" y="0" font-family="monospace" font-size="9" fill="#666">slot 1</text>
      <rect x="-40" y="-12" width="120" height="18" fill="#C8E6C9" stroke="#4CAF50" stroke-width="1"/>
      <text x="20" y="0" text-anchor="middle" font-family="monospace" font-size="8" fill="#333">totalSupply</text>
    </g>

    <g transform="translate(0, 90)">
      <text x="-80" y="0" font-family="monospace" font-size="9" fill="#666">slot 2</text>
      <rect x="-40" y="-12" width="120" height="18" fill="#A5D6A7" stroke="#4CAF50" stroke-width="1"/>
      <text x="20" y="0" text-anchor="middle" font-family="monospace" font-size="8" fill="#333">mapping base</text>
    </g>

    <g transform="translate(0, 125)">
      <text x="-80" y="0" font-family="monospace" font-size="9" fill="#666">...</text>
      <rect x="-40" y="-12" width="120" height="30" fill="#81C784" stroke="#4CAF50" stroke-width="1" stroke-dasharray="3,2"/>
      <text x="20" y="5" text-anchor="middle" font-family="monospace" font-size="8" fill="#333">2^256 slots</text>
    </g>

    <!-- Storage note -->
    <text y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Key-value store</text>
    <text y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">256-bit â†’ 256-bit</text>
  </g>

  <!-- Calldata (Far Right) -->
  <g transform="translate(720, 100)">
    <text y="-15" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">Calldata</text>
    <text y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">(Read-only input)</text>

    <rect x="-50" y="20" width="100" height="150" fill="#F3E5F5" stroke="#9C27B0" stroke-width="2"/>

    <text x="0" y="50" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">selector</text>
    <rect x="-40" y="55" width="80" height="15" fill="#E1BEE7" stroke="#9C27B0" stroke-width="1"/>
    <text x="0" y="67" text-anchor="middle" font-family="monospace" font-size="8" fill="#666">4 bytes</text>

    <text x="0" y="95" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">arg 0</text>
    <rect x="-40" y="100" width="80" height="15" fill="#CE93D8" stroke="#9C27B0" stroke-width="1"/>

    <text x="0" y="130" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">arg 1</text>
    <rect x="-40" y="135" width="80" height="15" fill="#BA68C8" stroke="#9C27B0" stroke-width="1"/>

    <text y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">ABI encoded</text>
    <text y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666">Immutable</text>
  </g>

  <!-- Code section -->
  <g transform="translate(400, 350)">
    <text y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">Program Counter &amp; Bytecode</text>

    <rect x="-350" y="15" width="700" height="50" fill="#ECEFF1" stroke="#607D8B" stroke-width="2" rx="5"/>

    <!-- Bytecode representation -->
    <text x="-320" y="45" font-family="monospace" font-size="10" fill="#333">60 80 60 40 52 34 80 15 61 00 10 57 60 00 80 fd 5b 50 61 03 ...</text>
    <text x="-320" y="58" font-family="monospace" font-size="8" fill="#999">PUSH1 PUSH1 MSTORE CALLVALUE DUP1 ISZERO PUSH2 JUMPI PUSH1 DUP1 REVERT JUMPDEST...</text>

    <!-- PC indicator -->
    <polygon points="-280,20 -275,10 -270,20" fill="#F44336"/>
    <text x="-275" y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#F44336">PC</text>
  </g>

  <!-- Gas meter -->
  <g transform="translate(750, 380)">
    <text y="0" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333">Gas</text>
    <rect x="-30" y="5" width="60" height="15" fill="#FFCDD2" stroke="#F44336" stroke-width="1" rx="3"/>
    <rect x="-30" y="5" width="40" height="15" fill="#EF5350" rx="3"/>
    <text x="0" y="16" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#FFF">remaining</text>
  </g>

  <!-- Arrows showing data flow -->
  <defs>
    <marker id="arrow" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
      <polygon points="0 0, 6 3, 0 6" fill="#999"/>
    </marker>
  </defs>

  <path d="M 180 300 Q 250 320 320 300" stroke="#999" stroke-width="1" fill="none" marker-end="url(#arrow)" stroke-dasharray="3,2"/>
  <path d="M 380 300 Q 450 320 540 300" stroke="#999" stroke-width="1" fill="none" marker-end="url(#arrow)" stroke-dasharray="3,2"/>
</svg>
