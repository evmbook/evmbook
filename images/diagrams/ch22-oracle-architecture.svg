<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 500" width="800" height="500">
  <defs>
    <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FAFBFC"/>
      <stop offset="100%" style="stop-color:#F0F4F8"/>
    </linearGradient>
    <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="3" stdDeviation="5" flood-opacity="0.1"/>
    </filter>
    <linearGradient id="sourceGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#6B7280"/>
      <stop offset="100%" style="stop-color:#4B5563"/>
    </linearGradient>
    <linearGradient id="nodeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F59E0B"/>
      <stop offset="100%" style="stop-color:#D97706"/>
    </linearGradient>
    <linearGradient id="aggregatorGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#627EEA"/>
      <stop offset="100%" style="stop-color:#4B6DD0"/>
    </linearGradient>
    <linearGradient id="consumerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8B5CF6"/>
      <stop offset="100%" style="stop-color:#7C3AED"/>
    </linearGradient>
    <marker id="flowArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#627EEA"/>
    </marker>
  </defs>

  <rect width="100%" height="100%" fill="url(#bgGradient)"/>
  <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
    <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#E5E7EB" stroke-width="0.5"/>
  </pattern>
  <rect width="100%" height="100%" fill="url(#grid)" opacity="0.4"/>

  <text x="400" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#1a1a3a">Oracle Architecture</text>
  <text x="400" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#6B7280">Bringing off-chain data on-chain securely</text>

  <!-- Off-chain label -->
  <rect x="40" y="70" width="160" height="24" rx="4" fill="#F3F4F6"/>
  <text x="120" y="87" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#6B7280">OFF-CHAIN</text>

  <!-- On-chain label -->
  <rect x="450" y="70" width="160" height="24" rx="4" fill="#EEF2FF"/>
  <text x="530" y="87" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#4338CA">ON-CHAIN</text>

  <!-- Divider -->
  <line x1="350" y1="100" x2="350" y2="400" stroke="#E5E7EB" stroke-width="2" stroke-dasharray="8,4"/>

  <!-- Data Sources (Left Column) -->
  <g transform="translate(100, 150)" filter="url(#dropShadow)">
    <rect x="-60" y="-30" width="120" height="60" rx="8" fill="url(#sourceGradient)"/>
    <text y="-5" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#FFF">Exchange A</text>
    <text y="12" text-anchor="middle" font-family="monospace" font-size="8" fill="#D1D5DB">BTC/USD: $62,450</text>
  </g>
  <g transform="translate(100, 230)" filter="url(#dropShadow)">
    <rect x="-60" y="-30" width="120" height="60" rx="8" fill="url(#sourceGradient)"/>
    <text y="-5" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#FFF">Exchange B</text>
    <text y="12" text-anchor="middle" font-family="monospace" font-size="8" fill="#D1D5DB">BTC/USD: $62,448</text>
  </g>
  <g transform="translate(100, 310)" filter="url(#dropShadow)">
    <rect x="-60" y="-30" width="120" height="60" rx="8" fill="url(#sourceGradient)"/>
    <text y="-5" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#FFF">Exchange C</text>
    <text y="12" text-anchor="middle" font-family="monospace" font-size="8" fill="#D1D5DB">BTC/USD: $62,455</text>
  </g>

  <!-- Oracle Nodes (Middle) -->
  <g transform="translate(260, 180)" filter="url(#dropShadow)">
    <rect x="-50" y="-25" width="100" height="50" rx="8" fill="url(#nodeGradient)"/>
    <text y="-5" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#FFF">Node 1</text>
    <text y="12" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#FEF3C7">fetch + sign</text>
  </g>
  <g transform="translate(260, 260)" filter="url(#dropShadow)">
    <rect x="-50" y="-25" width="100" height="50" rx="8" fill="url(#nodeGradient)"/>
    <text y="-5" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#FFF">Node 2</text>
    <text y="12" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#FEF3C7">fetch + sign</text>
  </g>
  <g transform="translate(260, 340)" filter="url(#dropShadow)">
    <rect x="-50" y="-25" width="100" height="50" rx="8" fill="url(#nodeGradient)"/>
    <text y="-5" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#FFF">Node N</text>
    <text y="12" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#FEF3C7">fetch + sign</text>
  </g>

  <!-- Arrows: Sources → Nodes -->
  <line x1="160" y1="150" x2="200" y2="175" stroke="#6B7280" stroke-width="1.5"/>
  <line x1="160" y1="230" x2="200" y2="230" stroke="#6B7280" stroke-width="1.5"/>
  <line x1="160" y1="310" x2="200" y2="290" stroke="#6B7280" stroke-width="1.5"/>

  <!-- Aggregator Contract (On-chain) -->
  <g transform="translate(470, 230)" filter="url(#dropShadow)">
    <rect x="-80" y="-80" width="160" height="160" rx="12" fill="url(#aggregatorGradient)"/>
    <text y="-55" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#FFF">Aggregator</text>
    <text y="-38" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#C7D2FE">Contract</text>

    <rect x="-65" y="-25" width="130" height="40" rx="4" fill="#FFF" fill-opacity="0.2"/>
    <text y="-8" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#FFF">Median Price</text>
    <text y="8" text-anchor="middle" font-family="monospace" font-size="10" font-weight="bold" fill="#FFF">$62,450</text>

    <rect x="-65" y="25" width="130" height="40" rx="4" fill="#FFF" fill-opacity="0.2"/>
    <text y="42" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#E0E7FF">latestRoundData()</text>
    <text y="56" text-anchor="middle" font-family="monospace" font-size="7" fill="#C7D2FE">price, timestamp, round</text>
  </g>

  <!-- Arrows: Nodes → Aggregator -->
  <line x1="310" y1="180" x2="380" y2="200" stroke="#627EEA" stroke-width="2" marker-end="url(#flowArrow)"/>
  <line x1="310" y1="260" x2="380" y2="240" stroke="#627EEA" stroke-width="2" marker-end="url(#flowArrow)"/>
  <line x1="310" y1="340" x2="380" y2="280" stroke="#627EEA" stroke-width="2" marker-end="url(#flowArrow)"/>

  <!-- Consumer Contracts -->
  <g transform="translate(660, 150)" filter="url(#dropShadow)">
    <rect x="-60" y="-30" width="120" height="60" rx="8" fill="url(#consumerGradient)"/>
    <text y="-5" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#FFF">Lending</text>
    <text y="12" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#EDE9FE">liquidations</text>
  </g>
  <g transform="translate(660, 230)" filter="url(#dropShadow)">
    <rect x="-60" y="-30" width="120" height="60" rx="8" fill="url(#consumerGradient)"/>
    <text y="-5" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#FFF">Derivatives</text>
    <text y="12" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#EDE9FE">settlements</text>
  </g>
  <g transform="translate(660, 310)" filter="url(#dropShadow)">
    <rect x="-60" y="-30" width="120" height="60" rx="8" fill="url(#consumerGradient)"/>
    <text y="-5" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#FFF">Stablecoins</text>
    <text y="12" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#EDE9FE">peg maintenance</text>
  </g>

  <!-- Arrows: Aggregator → Consumers -->
  <line x1="550" y1="190" x2="590" y2="160" stroke="#8B5CF6" stroke-width="2"/>
  <line x1="550" y1="230" x2="590" y2="230" stroke="#8B5CF6" stroke-width="2"/>
  <line x1="550" y1="270" x2="590" y2="300" stroke="#8B5CF6" stroke-width="2"/>

  <!-- Key insight -->
  <g transform="translate(400, 450)">
    <rect x="-350" y="-30" width="700" height="60" rx="8" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1"/>
    <text y="-10" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#92400E">Key Insight</text>
    <text y="8" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#B45309">Multiple independent nodes + aggregation reduces manipulation risk. Median filters outliers.</text>
    <text y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#B45309">Always check staleness: if (block.timestamp - updatedAt &gt; HEARTBEAT) revert StalePrice();</text>
  </g>
</svg>
